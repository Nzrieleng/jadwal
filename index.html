<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Planner Pro - Cinematic Executive</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4834d4;
            --primary-light: #686de0;
            --accent: #22a6b3;
            --bg: #ebf0f7;
            --text-dark: #130f40;
            --text-light: #95afc0;
            --white: #ffffff;
            --danger: #eb4d4b;
            --warning: #f0932b;
            --success: #6ab04c;
            --glass: rgba(255, 255, 255, 0.88);
        }

        * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1); }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-dark);
            margin: 0; min-height: 100vh;
            display: flex; justify-content: center; overflow-x: hidden;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95) translateY(20px); filter: blur(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }

        @keyframes fadeOutDown {
            from { opacity: 1; transform: translateY(0); filter: blur(0); }
            to { opacity: 0; transform: translateY(40px); filter: blur(20px); }
        }

        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* --- AUTH SYSTEM --- */
        #authOverlay {
            position: fixed; inset: 0; background: rgba(19, 15, 64, 0.9);
            backdrop-filter: blur(25px); display: flex; justify-content: center; 
            align-items: center; z-index: 2000; transition: all 0.8s ease;
        }
        
        .auth-box {
            background: var(--white); padding: 45px; border-radius: 35px;
            width: 90%; max-width: 400px; text-align: center; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: fadeInScale 0.6s ease forwards;
        }

        .auth-box input { width: 100%; padding: 16px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 16px; outline: none; }
        .btn-auth { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; }

        /* --- LAYOUT --- */
        .main-wrapper {
            width: 100%; max-width: 1200px; padding: 40px 20px;
            display: grid; grid-template-columns: 1fr 350px; gap: 30px;
            display: none; /* Inisialisasi sembunyi untuk animasi launch */
        }

        .main-wrapper.active {
            display: grid;
            animation: fadeInScale 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        .main-wrapper.logging-out {
            animation: fadeOutDown 0.7s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @media (max-width: 900px) { .main-wrapper { grid-template-columns: 1fr; } }

        .glass-card {
            background: var(--glass); backdrop-filter: blur(15px);
            border-radius: 40px; padding: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.6);
        }

        /* --- COMPONENTS --- */
        #liveClock { font-size: 3rem; font-weight: 800; color: var(--primary); letter-spacing: -2px; }
        
        .progress-circle {
            width: 70px; height: 70px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; position: relative;
            background: conic-gradient(var(--primary) 0%, #eee 0%);
        }
        .progress-circle::after {
            content: attr(data-percent); position: absolute; width: 55px; height: 55px;
            background: white; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-weight: 800; font-size: 0.9rem;
        }

        .task-item {
            background: var(--white); padding: 20px; border-radius: 22px;
            margin-bottom: 12px; display: flex; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02); cursor: pointer;
            border-left: 8px solid #eee;
            animation: slideInRight 0.4s ease backwards;
        }
        .task-item.prio-high { border-left-color: var(--danger); }
        .task-item.prio-mid { border-left-color: var(--warning); }
        .task-item.prio-low { border-left-color: var(--success); }

        .pomo-card {
            background: var(--text-dark); color: white; padding: 30px; border-radius: 35px;
            text-align: center; position: sticky; top: 40px;
            box-shadow: 0 20px 40px rgba(19, 15, 64, 0.3);
        }

        .sidebar {
            position: fixed; right: -450px; top: 0; bottom: 0;
            width: 420px; background: var(--white); padding: 40px;
            box-shadow: -20px 0 60px rgba(0,0,0,0.1); z-index: 1000;
            transition: right 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .sidebar.active { right: 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="authOverlay">
    <div class="auth-box" id="loginForm">
        <h1 style="color: var(--primary); font-weight: 800;">Executive.</h1>
        <p style="color: var(--text-light); margin-bottom: 30px;">Premium Time Management</p>
        <input type="text" id="userIn" placeholder="Username">
        <input type="password" id="passIn" placeholder="Password">
        <button class="btn-auth" onclick="handleLogin()">Sign In</button>
        <p onclick="toggleAuth(true)" style="cursor:pointer; margin-top:20px; font-size:0.8rem; font-weight:600; color: var(--primary-light);">Daftar Akun Baru</p>
    </div>
    <div class="auth-box hidden" id="registerForm">
        <h1 style="color: var(--accent); font-weight: 800;">Join Elite.</h1>
        <input type="text" id="regUser" placeholder="New Username">
        <input type="password" id="regPass" placeholder="New Password">
        <button class="btn-auth" onclick="handleRegister()" style="background:var(--accent)">Create Account</button>
        <p onclick="toggleAuth(false)" style="cursor:pointer; margin-top:20px; font-size:0.8rem; color: var(--text-light);">Sudah punya akun? Login</p>
    </div>
</div>

<div class="main-wrapper" id="mainWrapper">
    <div class="left-panel">
        <div class="glass-card">
            <header style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <span id="liveClock">00:00:00</span>
                    <span id="greeting" style="display:block; color:var(--text-light); font-weight:600; margin-top:5px;">Syncing system...</span>
                </div>
                <div class="progress-circle" id="taskStats" data-percent="0%"></div>
            </header>

            <div style="display: flex; gap: 20px; margin: 30px 0;">
                <div style="flex:1">
                    <label style="font-size:0.7rem; font-weight:800; color:var(--text-light)">PILIH TANGGAL</label>
                    <input type="date" id="globalDatePicker" class="styled-input" style="width:100%; padding:12px; border:2px solid #eee; border-radius:12px; margin-top:5px;" onchange="render()">
                </div>
                <div style="flex:2">
                    <label style="font-size:0.7rem; font-weight:800; color:var(--text-light)">CARI TUGAS</label>
                    <input type="text" id="searchInput" placeholder="Cari keyword..." style="width:100%; padding:12px; border:2px solid #eee; border-radius:12px; margin-top:5px;" oninput="render()">
                </div>
            </div>

            <div style="background:white; padding:25px; border-radius:25px; margin-bottom:25px; box-shadow: 0 10px 30px rgba(0,0,0,0.02);">
                <div style="display:grid; grid-template-columns: 1fr auto auto; gap:10px;">
                    <input type="text" id="taskInput" placeholder="Strategi apa hari ini?" style="padding:12px; border:2px solid #f0f3f7; border-radius:12px; outline:none;">
                    <input type="time" id="taskTime" style="padding:12px; border:2px solid #f0f3f7; border-radius:12px;">
                    <select id="taskPrio" style="padding:12px; border:2px solid #f0f3f7; border-radius:12px;">
                        <option value="prio-low">Low</option>
                        <option value="prio-mid">Normal</option>
                        <option value="prio-high">Urgent</option>
                    </select>
                </div>
                <button onclick="addTask()" style="width:100%; margin-top:10px; background:var(--primary); color:white; border:none; padding:15px; border-radius:12px; font-weight:800; cursor:pointer;">ADD TO SCHEDULE</button>
            </div>

            <div id="taskList"></div>
        </div>
    </div>

    <div class="right-panel">
        <div class="pomo-card">
            <h3 style="margin:0; font-size:0.8rem; opacity:0.6; letter-spacing:1px;">DEEP WORK TIMER</h3>
            <div id="pomoTimer">25:00</div>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button onclick="togglePomo()" id="pomoToggle" style="padding:10px 20px; border-radius:12px; border:none; background:var(--primary); color:white; font-weight:800; cursor:pointer;">START</button>
                <button onclick="resetPomo()" style="padding:10px 20px; border-radius:12px; border:none; background:rgba(255,255,255,0.1); color:white; font-weight:600; cursor:pointer;">RESET</button>
            </div>
        </div>

        <div class="glass-card" style="margin-top:25px; text-align:center;">
            <div onclick="openProfileSidebar()" style="cursor:pointer;">
                <div id="avatarFrame" style="width:90px; height:90px; border-radius:30px; background:#f0f3f7; margin:0 auto 15px; overflow:hidden; border:3px solid var(--primary); display:flex; align-items:center; justify-content:center;">
                    <img id="sideAvatar" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                    <span id="pPlaceholder">?</span>
                </div>
                <h4 id="sideName" style="margin:0; font-weight:800;">Executive User</h4>
                <p style="font-size:0.75rem; color:var(--text-light); margin:5px 0 0;">Platinum Membership</p>
            </div>
            <button onclick="handleLogout()" style="margin-top:25px; background:none; border:none; color:var(--danger); font-weight:800; cursor:pointer; font-size:0.9rem;">SIGN OUT</button>
        </div>
    </div>
</div>

<div class="sidebar" id="profileSidebar">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="font-weight:800;">Profile Settings</h2>
        <button onclick="closeAllSidebars()" style="border:none; background:none; font-size:2rem; cursor:pointer;">&times;</button>
    </div>
    <div style="text-align:center; margin-top:40px;">
        <div onclick="document.getElementById('pInput').click()" style="width:130px; height:130px; border-radius:40px; background:#f8fafb; margin:0 auto; cursor:pointer; overflow:hidden; border:2px dashed var(--primary); display:flex; align-items:center; justify-content:center;">
            <img id="pImgShow" src="" style="display:none; width:100%; height:100%; object-fit:cover;">
            <span style="font-weight:700; color:var(--primary)">UBAH FOTO</span>
        </div>
        <input type="file" id="pInput" style="display:none" onchange="uploadPhoto(event)">
        <input type="text" id="pNameInput" placeholder="Update Display Name" oninput="updateProfile()" style="margin-top:30px; width:100%; padding:15px; border-radius:15px; border:2px solid #eee; outline:none; font-family:inherit; font-weight:600;">
    </div>
</div>

<div class="sidebar" id="detailSidebar">
    <h2 id="detTitle" style="font-weight:800;">Detail</h2>
    <label style="font-size:0.7rem; font-weight:800; color:var(--text-light);">NOTES & STRATEGY</label>
    <textarea id="detNote" oninput="updateDetail()" style="width:100%; height:150px; padding:18px; border-radius:18px; border:2px solid #eee; font-family:inherit; outline:none; margin:10px 0 20px;" placeholder="Tulis catatan di sini..."></textarea>
    
    <label style="font-size:0.7rem; font-weight:800; color:var(--text-light);">DOCUMENTATION</label>
    <div onclick="document.getElementById('taskPhotoIn').click()" id="detPhotoArea" style="width:100%; height:200px; background:#f9f9f9; border-radius:20px; margin:10px 0; display:flex; align-items:center; justify-content:center; overflow:hidden; border:2px dashed #ddd; cursor:pointer;">
        <span>Tambah Foto Tugas</span>
    </div>
    <input type="file" id="taskPhotoIn" style="display:none" onchange="uploadTaskPhoto(event)">
    <button onclick="deleteTask()" style="width:100%; padding:18px; background:var(--danger); color:white; border:none; border-radius:18px; font-weight:800; cursor:pointer; margin-top:20px;">HAPUS DARI JADWAL</button>
</div>

<script>
    let currentUser = JSON.parse(sessionStorage.getItem('activeUser'));
    let usersDb = JSON.parse(localStorage.getItem('usersDb')) || {};
    let pomoInterval, pomoTime = 1500, isPomoRunning = false;

    document.getElementById('globalDatePicker').value = new Date().toISOString().split('T')[0];

    function toggleAuth(isReg) {
        const login = document.getElementById('loginForm');
        const reg = document.getElementById('registerForm');
        login.style.opacity = '0'; reg.style.opacity = '0';
        setTimeout(() => {
            login.classList.toggle('hidden', isReg);
            reg.classList.toggle('hidden', !isReg);
            login.style.opacity = '1'; reg.style.opacity = '1';
        }, 300);
    }

    function handleRegister() {
        const u = document.getElementById('regUser').value.trim();
        const p = document.getElementById('regPass').value.trim();
        if(!u || !p) return alert("Lengkapi data!");
        usersDb[u] = { password: p, data: { tasks: [], user: { name: u, photo: null } } };
        save(); alert("Registrasi Berhasil!"); toggleAuth(false);
    }

    function handleLogin() {
        const u = document.getElementById('userIn').value;
        const p = document.getElementById('passIn').value;
        if(usersDb[u] && usersDb[u].password === p) {
            currentUser = u;
            sessionStorage.setItem('activeUser', JSON.stringify(u));
            launch();
        } else alert("Username/Password Salah!");
    }

    function launch() {
        const overlay = document.getElementById('authOverlay');
        const wrapper = document.getElementById('mainWrapper');
        
        overlay.style.opacity = "0";
        overlay.style.transform = "scale(1.1)";
        
        setTimeout(() => {
            overlay.style.display = "none";
            wrapper.style.display = "grid";
            wrapper.classList.add('active');
            sync(); render();
        }, 600);
    }

    function handleLogout() {
        const wrapper = document.getElementById('mainWrapper');
        wrapper.classList.add('logging-out');
        
        setTimeout(() => {
            sessionStorage.clear();
            location.reload();
        }, 700);
    }

    function sync() {
        const u = usersDb[currentUser].data.user;
        document.getElementById('greeting').innerText = `Elite Executive: ${u.name}`;
        document.getElementById('sideName').innerText = u.name;
        if(u.photo) {
            document.getElementById('sideAvatar').src = u.photo;
            document.getElementById('sideAvatar').style.display = "block";
            document.getElementById('pPlaceholder').style.display = "none";
            document.getElementById('pImgShow').src = u.photo;
            document.getElementById('pImgShow').style.display = "block";
        }
    }

    let selIdx = null;

    function render() {
        const list = document.getElementById('taskList');
        list.innerHTML = '';
        const date = document.getElementById('globalDatePicker').value;
        const search = document.getElementById('searchInput').value.toLowerCase();
        
        if(!usersDb[currentUser].data.tasks) usersDb[currentUser].data.tasks = [];
        const all = usersDb[currentUser].data.tasks;
        
        const filtered = all.filter(t => t.date === date && t.title.toLowerCase().includes(search))
                           .sort((a,b) => (a.time > b.time ? 1 : -1));

        filtered.forEach((t, i) => {
            const idx = all.indexOf(t);
            const div = document.createElement('div');
            div.className = `task-item ${t.prio} ${t.completed ? 'completed' : ''}`;
            div.style.animationDelay = `${i * 0.05}s`;
            div.onclick = () => openDet(idx);
            div.innerHTML = `
                <div class="check-box" onclick="event.stopPropagation(); toggleT(${idx})"></div>
                <span class="time-badge">${t.time || '--:--'}</span>
                <span style="flex:1; font-weight:600;">${t.title}</span>
            `;
            list.appendChild(div);
        });

        const total = filtered.length;
        const done = filtered.filter(t => t.completed).length;
        const perc = total === 0 ? 0 : Math.round((done/total)*100);
        const stats = document.getElementById('taskStats');
        stats.setAttribute('data-percent', perc + '%');
        stats.style.background = `conic-gradient(var(--primary) ${perc}%, #eee 0%)`;
        save();
    }

    function addTask() {
        const title = document.getElementById('taskInput').value.trim();
        if(!title) return;
        usersDb[currentUser].data.tasks.push({
            title, time: document.getElementById('taskTime').value,
            date: document.getElementById('globalDatePicker').value,
            prio: document.getElementById('taskPrio').value,
            completed: false, note: "", photo: null
        });
        document.getElementById('taskInput').value = '';
        render();
    }

    function toggleT(i) { usersDb[currentUser].data.tasks[i].completed = !usersDb[currentUser].data.tasks[i].completed; render(); }

    function openDet(i) {
        selIdx = i;
        const t = usersDb[currentUser].data.tasks[selIdx];
        document.getElementById('detTitle').innerText = t.title;
        document.getElementById('detNote').value = t.note || "";
        document.getElementById('detPhotoArea').innerHTML = t.photo ? `<img src="${t.photo}" style="width:100%; height:100%; object-fit:cover;">` : "<span>Tambah Dokumentasi</span>";
        document.getElementById('detailSidebar').classList.add('active');
    }

    function updateDetail() { usersDb[currentUser].data.tasks[selIdx].note = document.getElementById('detNote').value; save(); }

    function uploadTaskPhoto(e) {
        const r = new FileReader();
        r.onload = () => { usersDb[currentUser].data.tasks[selIdx].photo = r.result; openDet(selIdx); save(); };
        r.readAsDataURL(e.target.files[0]);
    }

    function deleteTask() { usersDb[currentUser].data.tasks.splice(selIdx, 1); closeAllSidebars(); render(); }

    // POMODORO ENGINE
    function togglePomo() {
        if(isPomoRunning) {
            clearInterval(pomoInterval);
            document.getElementById('pomoToggle').innerText = "RESUME";
        } else {
            pomoInterval = setInterval(() => {
                pomoTime--; updatePomoUI();
                if(pomoTime <= 0) { clearInterval(pomoInterval); alert("Fokus Selesai!"); resetPomo(); }
            }, 1000);
            document.getElementById('pomoToggle').innerText = "PAUSE";
        }
        isPomoRunning = !isPomoRunning;
    }

    function resetPomo() { clearInterval(pomoInterval); pomoTime = 1500; isPomoRunning = false; updatePomoUI(); document.getElementById('pomoToggle').innerText = "START"; }
    function updatePomoUI() {
        const m = Math.floor(pomoTime / 60); const s = pomoTime % 60;
        document.getElementById('pomoTimer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
    }

    function openProfileSidebar() { document.getElementById('profileSidebar').classList.add('active'); }
    function closeAllSidebars() { document.querySelectorAll('.sidebar').forEach(s => s.classList.remove('active')); }
    function updateProfile() { usersDb[currentUser].data.user.name = document.getElementById('pNameInput').value; sync(); save(); }
    function uploadPhoto(e) {
        const r = new FileReader();
        r.onload = () => { usersDb[currentUser].data.user.photo = r.result; sync(); save(); };
        r.readAsDataURL(e.target.files[0]);
    }
    function save() { localStorage.setItem('usersDb', JSON.stringify(usersDb)); }

    setInterval(() => { document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('id-ID'); }, 1000);
    if(currentUser) launch();
</script>
</body>
</html>